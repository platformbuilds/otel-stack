:80 {
	# --- API first (proxy to backend) ---
	handle /api/* {
		# keep the full path: /api/... goes upstream unchanged
		reverse_proxy {$API_BASE}
	}

	handle /healthz {
		reverse_proxy {$API_BASE}
	}
	handle /readyz {
		reverse_proxy {$API_BASE}
	}

	# --- Static SPA last ---
	handle {
		root * /srv
		try_files {path} /index.html
		file_server
	}

	# Cache headers with regex matchers (no glob *)
	header {
		@html path_regexp html \.html$
		@assets path_regexp assets \.(js|css|png|jpg|jpeg|gif|svg|woff2?)$
		@immutable path_regexp immutable \.(js|css)$

		@html Cache-Control "no-store"
		@assets Cache-Control "public, max-age=31536000, immutable"
	}
}